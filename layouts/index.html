{{ define "main" }}
<main class="main" role="main">
  <div class="posts-list">
    {{ $sections := .Site.Params.mainSections | default (slice "posts") }}
    {{ $pages := where .Site.RegularPages "Type" "in" $sections }}
    {{ $p := .Paginate $pages }}

    {{ range $p.Pages }}
      <article class="post">
        <header class="post-header">
          <h2 class="post-title">
            <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          </h2>

          <div class="post-meta">
            <time datetime="{{ .Date.Format "2006-01-02" }}">
              <strong>{{ .Date.Format "Jan 2, 2006" }}</strong>
            </time>
            {{- $cats := .Params.categories -}}
            {{- $tags := .Params.tags -}}

            {{- with $cats -}}
            &nbsp;•&nbsp;
            <strong>Categories:</strong>&nbsp;
              {{- range $i, $c := . -}}
                {{- if $i }}, {{ end -}}
                <a href="{{ (printf "/categories/%s/" ($c | urlize)) | relURL }}">{{ $c }}</a>
              {{- end -}}
            {{- end -}}

            {{- if and $cats $tags }}, {{ end -}}

            {{- with $tags -}}
            &nbsp;•&nbsp;
            <strong>Tags:</strong>&nbsp;
              {{- range $i, $t := . -}}
                {{- if $i }}, {{ end -}}
                <a href="{{ (printf "/tags/%s/" ($t | urlize)) | relURL }}">#{{ $t }}</a>
              {{- end -}}
            {{- end -}}
          </div>
        </header>

        {{/* Summary with fallback if .Summary is empty */}}
        {{ $sum := .Summary }}
        {{ if not $sum }}
          {{ $sum = ( .Plain | truncate 280 ) }}
        {{ end }}
        <div class="post-summary">{{ $sum | safeHTML }}</div>

        {{/* Read more link styled like bio widget buttons */}}
        <p>
          <a class="btn" href="{{ .RelPermalink }}">Read more →</a>
        </p>
      </article>
    {{ end }}

    {{ partial "pagination.html" . }}
  </div>
</main>
{{ end }}
