{{ define "main" }}
<main class="main" role="main">
  <div class="posts-list">
    {{ $sections := .Site.Params.mainSections | default (slice "posts") }}
    {{ $pages := where .Site.RegularPages "Type" "in" $sections }}
    {{ $p := .Paginate $pages }}

    {{ range $p.Pages }}
      <article class="post">
        <header class="post-header">
          <h2 class="post-title">
            <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          </h2>

          <div class="post-meta">
            <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
            {{- $cats := .Params.categories -}}
            {{- $tags := .Params.tags -}}
            {{- if or $cats $tags }} • {{ end -}}

            {{- with $cats -}}
              {{- range $i, $c := . -}}
                {{- if $i }}, {{ end -}}
                <a href="{{ (printf "/categories/%s/" ($c | urlize)) | relURL }}">{{ $c }}</a>
              {{- end -}}
            {{- end -}}

            {{- if and $cats $tags }}, {{ end -}}

            {{- with $tags -}}
              {{- range $i, $t := . -}}
                {{- if $i }}, {{ end -}}
                <a href="{{ (printf "/tags/%s/" ($t | urlize)) | relURL }}">#{{ $t }}</a>
              {{- end -}}
            {{- end -}}
          </div>
        </header>

        {{/* Summary (fallback to truncated plain content if needed) */}}
        {{ $sum := .Summary }}
        {{ if not $sum }}
          {{ $sum = ( .Plain | truncate 280 ) }}
        {{ end }}
        <div class="post-summary">{{ $sum | safeHTML }}</div>

        {{/* Always show Read more link */}}
        <p class="read-more">
          <a class="read-more-link" href="{{ .RelPermalink }}">Read more →</a>
        </p>
      </article>
    {{ end }}

    {{ partial "pagination.html" . }}
  </div>
</main>
{{ end }}
